const LUA_INCLUDE = "/usr/local/include/lua"
const LIBLUA = "/usr/local/lib/liblua.dylib"

run(`cc defs.c -o luadefs -I$LUA_INCLUDE`)
run(`./luadefs`)

open("deps.jl", "w+") do io
    println(io, """
            # This file is automatically generated. Do not edit.

            using Libdl

            const liblua = "$LIBLUA"

            let ptr = dlopen_e(liblua)
                if ptr == C_NULL
                    error("Failed to open liblua at $LIBLUA")
                else
                    dlclose(ptr)
                end
            end

            include("luadefs.jl")
            """)
end
